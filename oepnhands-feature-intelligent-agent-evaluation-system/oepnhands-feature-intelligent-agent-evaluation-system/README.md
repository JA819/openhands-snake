# 智能体评估系统

一站式智能体性能评估和分析平台，支持从DOCX文档生成问答对、多智能体并行测试、语义相似度评分和详细结果分析。

## 功能特性

- ✅ 支持多智能体并行测试（1-3个智能体）
- ✅ 自动化问答对生成
- ✅ 多维度相似度评分（余弦相似度、Jaccard相似度、综合评分）
- ✅ 详细的结果分析和可视化
- ✅ 任务进度实时监控
- ✅ 文件管理和下载
- ✅ 响应式Web界面
- ✅ 完整流水线一键处理

## 系统架构

### 后端技术栈
- **FastAPI**: 现代、快速的Web框架
- **SQLite + aiosqlite**: 轻量级异步数据库
- **aiohttp**: 异步HTTP客户端
- **scikit-learn**: 机器学习库（相似度计算）
- **jieba**: 中文分词
- **openpyxl**: Excel文件处理
- **python-docx**: Word文档处理

### 前端技术栈
- **HTML5 + CSS3**: 响应式界面设计
- **JavaScript (ES6+)**: 交互逻辑
- **Fetch API**: 异步数据请求
- **CSS Grid/Flexbox**: 现代布局

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动应用
```bash
python app.py
```

### 3. 访问系统
打开浏览器访问：`http://localhost:12000`

## 使用流程

### 方式一：完整流水线（推荐）
1. **配置智能体** → 前往"智能体配置"页面设置API
2. **启动流水线** → 在"完整流水线"页面上传DOCX文档
3. **一键处理** → 系统自动完成问答对生成、智能体测试、相似度评分
4. **查看结果** → 在"结果分析"页面查看详细分析

### 方式二：分步处理
1. **智能体配置** → 设置1-3个智能体的API地址和密钥
2. **问答对生成** → 上传DOCX文档，生成标准问答对
3. **Dify测试** → 使用问答对测试智能体性能
4. **相似度评分** → 计算标准答案与智能体答案的相似度
5. **结果分析** → 详细分析和对比不同智能体的表现

## 页面功能说明

### 🏠 首页
- 系统功能概览
- 快速导航
- 使用流程指引

### 🤖 智能体配置
- 支持配置1-3个智能体
- API连接状态检测
- 智能体信息管理

### 📊 系统仪表盘
- 系统健康状态监控
- 任务统计概览
- 文件统计信息
- 最近任务列表

### 🔄 完整流水线
- 一键完成全流程处理
- 实时进度监控
- 任务状态跟踪
- 结果文件下载

### 📝 问答对生成
- DOCX文档上传（支持多文件）
- 可配置段落数量和生成温度
- 自动生成Excel格式问答对
- 支持批量处理

### 🧪 Dify测试
- 智能体状态检查
- 并行测试多个智能体
- 可配置请求延迟
- 生成测试结果Excel

### 📈 相似度评分
- 多维度相似度计算
- 支持上传文件或选择已有文件
- 智能体评分对比
- 最佳智能体识别

### 🔍 结果分析
- 详细的答案对比
- 智能体性能排名
- 评分分布统计
- 问题级别的详细分析
- 性能洞察和改进建议

### 📁 文件管理
- 输出文件列表
- 文件搜索和过滤
- 文件下载和删除
- 文件详情查看

### 📋 任务管理
- 任务列表和状态
- 任务详情查看
- 任务删除管理
- 实时状态更新

## API接口

### 智能体管理
- `POST /api/agents/config` - 配置智能体
- `GET /api/agents/status` - 获取智能体状态

### 任务管理
- `POST /api/qa/generate` - 生成问答对
- `POST /api/dify/test` - 测试智能体
- `POST /api/similarity/calculate` - 计算相似度
- `POST /api/pipeline/start` - 启动完整流水线

### 数据查询
- `GET /api/tasks` - 获取任务列表
- `GET /api/tasks/{task_id}` - 获取任务详情
- `GET /api/files` - 获取文件列表
- `GET /api/dashboard/stats` - 获取仪表盘统计

### 文件操作
- `GET /api/files/{filename}` - 下载文件
- `DELETE /api/files/{filename}` - 删除文件
- `GET /api/analysis/{filename}` - 获取分析数据

## 配置说明

### 智能体配置
每个智能体需要配置：
- **API URL**: 智能体的API接口地址
- **API Key**: 访问密钥（通常以"Bearer "开头）

### API密钥配置
系统需要两种API密钥：
- **问答生成API**: 用于从文档生成问答对
- **相似度计算API**: 用于计算语义相似度

### 参数调优
- **最大段落数**: 控制从文档中抽取的段落数量（1-100）
- **生成温度**: 控制AI生成的随机性（0-1，越低越稳定）
- **请求延迟**: 控制API请求频率，避免限流（0-10秒）

## 文件格式

### 输入文件
- **DOCX文档**: 支持标准Word文档格式
- **Excel文件**: 用于相似度评分的测试结果文件

### 输出文件
- **问答对Excel**: 包含问题和标准答案
- **测试结果Excel**: 包含智能体回答和标准答案
- **评分结果Excel**: 包含多维度相似度评分

## 故障排除

### 常见问题
1. **智能体连接失败**
   - 检查API地址是否正确
   - 确认API密钥有效
   - 检查网络连接

2. **文件上传失败**
   - 确认文件格式正确（DOCX/XLSX）
   - 检查文件大小（最大50MB）
   - 确保文件未损坏

3. **任务执行失败**
   - 查看任务详情中的错误信息
   - 检查API密钥是否正确
   - 确认网络连接稳定

### 性能优化
- 适当调整请求延迟避免API限流
- 合理设置段落数量平衡质量和速度
- 定期清理旧文件释放存储空间

## 开发说明

### 项目结构
```
/workspace/
├── app.py                 # 主应用文件
├── requirements.txt       # 依赖包列表
├── modules/              # 业务逻辑模块
│   ├── qa_generator.py   # 问答对生成
│   ├── agent_tester.py   # 智能体测试
│   ├── similarity_scorer.py # 相似度计算
│   ├── database.py       # 数据库操作
│   ├── task_manager.py   # 任务管理
│   ├── file_manager.py   # 文件管理
│   └── analyzer.py       # 结果分析
├── templates/            # HTML模板
├── static/              # 静态资源
│   ├── css/            # 样式文件
│   └── js/             # JavaScript文件
├── uploads/             # 上传文件目录
└── outputs/             # 输出文件目录
```

### 扩展开发
- 添加新的相似度计算方法
- 支持更多文档格式
- 集成更多智能体平台
- 添加数据可视化图表
- 实现用户权限管理

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue到项目仓库
- 发送邮件到开发团队

---

**智能体评估系统** - 让智能体性能评估变得简单高效！